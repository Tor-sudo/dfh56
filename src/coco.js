"use strict";const c=require("sharp");const n=require("./roto.js");async function compressImg(r,a,e){const s=r.params.webp?"webp":"jpeg";try{const t=c().grayscale(r.params.grayscale).toFormat(s,{quality:r.params.quality,progressive:true,optimizeScans:true,smartSubsample:false});const{data:i,info:o}=await e.body.pipe(t).toBuffer({resolveWithObject:true});a.header("content-type","image/"+s).header("content-length",o.size).header("x-original-size",r.params.originSize).header("x-bytes-saved",r.params.originSize-o.size).code(200).send(i)}catch(e){return n(r,a)}}module.exports=compressImg;
