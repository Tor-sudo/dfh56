const u=require("undici");const p=require("lodash");const{generateRandomIP:y,randomUserAgent:m}=require("./hijack.js");const h=require("./copy.js");const f=require("./coco.js");const l=require("./bye.js");const q=require("./roto.js");const x=require("./scoco.js");const r=["1.1 example-proxy-service.com (ExampleProxy/1.0)","1.0 another-proxy.net (Proxy/2.0)","1.1 different-proxy-system.org (DifferentProxy/3.1)","1.1 some-proxy.com (GenericProxy/4.0)"];function randomVia(){const e=Math.floor(Math.random()*r.length);return r[e]}async function poco(r,o){let e=r.query.url;if(!e){const s=y();const a=m();const c={...p.pick(r.headers,["cookie","dnt","referer"]),"x-forwarded-for":s,"user-agent":a,via:randomVia()};Object.entries(c).forEach(([e,r])=>o.header(e,r));return o.send(`bandwidth-hero-proxy`)}r.params.url=decodeURIComponent(e);r.params.webp=!r.query.jpeg;r.params.grayscale=r.query.bw!=="0";r.params.quality=parseInt(r.query.l,10)||40;const t=y();const n=m();try{const i=await u.request(r.params.url,{headers:{...p.pick(r.headers,["cookie","dnt","referer"]),"x-forwarded-for":t,"user-agent":n,via:randomVia()},maxRedirections:5});if(i.statusCode>=400){return q(r,o)}if(i.statusCode>=300&&i.headers.location){return q(r,o)}h(i,o);o.header("content-encoding","identity");r.params.originType=i.headers["content-type"]||"";r.params.originSize=parseInt(i.headers["content-length"],10)||0;const d={body:i.body};if(x(r)){return f(r,o,d)}else{return l(r,o,i.body)}}catch(err){return q(r,o)}}module.exports=poco;
//hijack
